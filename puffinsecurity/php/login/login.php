<?php    session_start();    include "../db/db_manipulation.php";    if(!isset($_SESSION['uname'])){        unset( $_SESSION['errorMessage'] );        unset( $_SESSION['blocked'] );        header("Location: ../../index.php");    }?><?php        global $allowed_devices;        if(isset($_POST)){        unset( $_SESSION['errorMessage'] );        unset( $_SESSION['blocked'] );    	$username = $_POST['name'];    	$password = $_POST['pass'];    	$os_browser = getOS_Browser();    	$os = $os_browser[0];    	$browser = $os_browser[1];    	$_SESSION['uname'] = $username;    	$blocked = isBlocked($username);    	$admin = isAdmin($username);        switch (existing($username, $password)){    	    case 1:    	        if(!$blocked){    	            if(newDevice($username, $browser, $os)){    	                if(getDevices($username) >= $allowed_devices){                            header("Location: ../add_device/add_device.php");                            break;    	                }    	                else saveDevice($username);    	            }    	            clearattempts($username);            		$location = "";            		if($admin){            		    $_SESSION['role'] = 1;            		    $location = "./logged_admin.php";            		}            		else{            		    $_SESSION['role'] = 0;                	    $location = "./logged_in.php";            		}            		logIP($username);            		header('Location: ' . $location);	                                }    	        else{        	        if(has_attempts($username)){        	            if(lockout_ended($username)){            	            $id=getID($username);            	            unlock($username);            	            clearattempts($username);                    		$location = "";                    		if(isAdmin($username)){                    		     $_SESSION['role'] = 1;                    		    $location = "./logged_admin.php";                    		}                    		else{                    		     $_SESSION['role'] = 0;                        	    $location = "./logged_in.php";                    		}                    		logIP($username);                    		header('Location: ' . $location);        	            }            	        else{        	                $_SESSION['blocked'] = 1;							header("Location: ../../index.php");						}        	        }        	        else{        	            $_SESSION['blocked'] = 1;            	        header("Location: ../../index.php");        	        }    	        }    	        break;            case -1:                if(!$blocked){                    attempt($username);					$_SESSION['errorMessage'] = 1;                }                else{					$_SESSION['blocked'] = 1;                }                //                header("Location: ../../index.php");                exit();                break;            case 0:                $_SESSION['errorMessage'] = 1;                header("Location: ../../index.php");                exit();                break;    	}    }?>